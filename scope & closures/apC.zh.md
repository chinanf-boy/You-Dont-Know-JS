
# 你不知道JS: 范围和闭包

# 附录C: 词法

虽然这个标题没有涉及到`这`在任何详细的机制,有一个话题涉及6`这`对词汇范围的一个重要方式,我们将很快检查ㄢ

6添加了一个特殊的函数声明的语法形式称为"箭头ℽ功能ㄢ看起来像这个: 

```js
var foo = a => {
	console.log( a );
};

foo( 2 ); // 2
```

所谓的"胖箭头ℽ经常被提到作为一个简短的手ㄢ_繁琐冗长的_(讽刺)`功能`关键词ㄢ

但是有一些更为重要的箭头功能,这与保存声明中的击键无关ㄢ

简单来说,这个代码有问题: 

```js
var obj = {
	id: "awesome",
	cool: function coolFn() {
		console.log( this.id );
	}
};

var id = "not awesome";

obj.cool(); // awesome

setTimeout( obj.cool, 100 ); // not awesome
```

问题是损失`这`结合在`cool()`功能ㄢ解决这个问题的方法多种多样,但一个经常重复的解决办法是`var =;`ㄢ

那可能看起来像: 

```js
var obj = {
	count: 0,
	cool: function coolFn() {
		var self = this;

		if (self.count < 1) {
			setTimeout( function timer(){
				self.count++;
				console.log( "awesome?" );
			}, 100 );
		}
	}
};

obj.cool(); // awesome?
```

没有太多的杂草在这里,`var =`"解ℽ,只是不理解整个问题及正确使用`这`绑定,而不是回到我们可能更舒服的地方: 词法范围ㄢ`自己`成为一个标识符,可以通过词法范围和闭包解决,而不关心`这`沿途绑定ㄢ

人们不喜欢写冗长的文章,尤其是一遍又一遍的重复ㄢ所以,一个动机ES6来帮助减轻这些情景,确实,_修理_常见的成语问题,比如这个ㄢ

6溶液,箭头的功能,介绍了行为称为"词汇ℽㄢ

```js
var obj = {
	count: 0,
	cool: function coolFn() {
		if (this.count < 1) {
			setTimeout( () => { // arrow-function ftw?
				this.count++;
				console.log( "awesome?" );
			}, 100 );
		}
	}
};

obj.cool(); // awesome?
```

简短的解释是,箭头函数在正常情况下,其行为与正常函数不一样ㄢ`这`结合.他们放弃了所有正常的规则`这`绑定,而不是接受`这`直接词汇包围范围的值,无论它是什么ㄢ

因此,在这个片段中,箭头函数没有得到它的`这`以某种不可预知的方式被绑定,它只是"继承ℽ了`这`结合的`cool()`函数(如果我们按照所示调用它,它是正确的!)ㄢ

而这使得短的代码,我的观点是,箭头的功能真的只是编纂成一个共同的语言的语法_错误_开发商,这是混淆和混淆"绑定ℽ规则与"词法作用域规则ℽㄢ

换句话说: 为什么去麻烦和冗长的使用`这`风格编码范式,只需将它与词汇引用混合在一起就可以把它切断ㄢ对于任何给定的代码来说,接受一种方法或另一种方法似乎是很自然的,而不是将它们混合在同一代码中ㄢ

**注: **从另一个箭头功能减损的是他们都是匿名的,不叫ㄢ关于匿名函数比命名函数不那么理想的原因,请参阅第3章ㄢ

在我看来,对这个"问题ℽ更恰当的做法是使用和接受ㄢ`这`机制准确ㄢ

```js
var obj = {
	count: 0,
	cool: function coolFn() {
		if (this.count < 1) {
			setTimeout( function timer(){
				this.count++; // `this` is safe because of `bind(..)`
				console.log( "more awesome" );
			}.bind( this ), 100 ); // look, `bind()`!
		}
	}
};

obj.cool(); // more awesome
```

无论你是喜欢新的词汇,这个箭头功能的行为,还是你喜欢的尝试和真实`()`重要的是要注意箭头函数是**不**只是少了"功能ℽ的打字ㄢ

他们有一个_故意的行为差异_我们应该学习和理解,如果我们选择,杠杆ㄢ

现在,我们完全理解词法作用域(和关闭!)理解词汇,这应该是轻而易举的事!
